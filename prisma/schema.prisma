// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Draft product data model derived from `src/models/Product.ts`.
// Fields are conservative (mostly optional) to avoid breaking existing data.
model Product {
  id                         String    @id @default(uuid())
  createdAt                  DateTime  @default(now())
  updatedAt                  DateTime  @updatedAt
  productName                String
  englishProductName         String?
  productCode                String?   @unique
  productCategory            String?
  classification             String?
  classificationId           String?
  brandId                    String?
  supplierId                 String?

  originalCost               Float?    
  representativeSellingPrice Float?    
  representativeSupplyPrice  Float?
  marketPrice                Float?
  consumerPrice              Float?
  foreignCurrencyPrice       Float?

  stock                      Int       @default(0)
  safeStock                  Int?
  isOutOfStock               Boolean   @default(false)
  isSelling                  Boolean   @default(true)
  isSoldout                  Boolean   @default(false)

  description                String?
  representativeImage        String?
  descriptionImages          String[]  @default([])

  width                      Float?
  height                     Float?
  depth                      Float?
  weight                     Float?
  volume                     Float?

  hsCode                     String?
  origin                     String?
  isTaxExempt                Boolean   @default(false)
  showProductNameOnInvoice   Boolean   @default(false)
  productDesigner            String?
  productRegistrant          String?
  productYear                String?
  productSeason              String?

  externalProductId          String?
  externalUrl                String?

  active                     Boolean   @default(true)

  // Relations
  variants                   ProductVariant[]

  @@map("products")
}

model ProductVariant {
  id           String   @id @default(uuid())
  productId    String
  sku          String?  @unique
  optionValues Json?    // store option name->value mapping
  stock        Int      @default(0)
  price        Float?

  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_variants")
}

model Supplier {
  id      String   @id @default(uuid())
  name    String
  contact String?
  email   String?
  phone   String?
  note    String?

  @@map("suppliers")
}

model InventoryMovement {
  id         String   @id @default(uuid())
  productId  String
  variantId  String?
  quantity   Int
  type       String   // e.g., 'adjustment','import','sale','transfer'
  note       String?
  createdAt  DateTime @default(now())

  @@map("inventory_movements")
}

// 사용자 관리 시스템 모델
model User {
  id          String    @id @default(cuid())
  name        String
  email       String    @unique
  password    String
  role        UserRole
  department  String?
  status      UserStatus @default(ACTIVE)
  avatar      String?
  phone       String?
  lastLogin   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  groups      UserGroup[]
  activityLogs ActivityLog[]

  @@map("users")
}

model UserGroup {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  users       User[]

  @@map("user_groups")
}

model Role {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  permissions Json     // 권한 배열을 JSON으로 저장
  isSystem    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("roles")
}

model ActivityLog {
  id          String   @id @default(cuid())
  userId      String
  userName    String
  action      String
  resource    String
  details     Json?    // 추가 세부사항을 JSON으로 저장
  ipAddress   String?
  userAgent   String?
  timestamp   DateTime @default(now())
  status      LogStatus @default(SUCCESS)
  sessionId   String?

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("activity_logs")
}

// Enums
enum UserRole {
  ADMIN
  MANAGER
  OPERATOR
  USER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
}

enum LogStatus {
  SUCCESS
  FAILED
  WARNING
}
